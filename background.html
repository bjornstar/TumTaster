<html>
<script type="text/javascript" src="soundmanager2.js"></script>
<script type="text/javascript">
  var playlist = new Array();
  var nowplaying = null;

  chrome.extension.onRequest.addListener(
    function(song, sender, sendResponse) {
      sendResponse({});
      playlist[song.song_url] = song.post_url;
      var mySoundObject = soundManager.createSound({
        id: song.post_url,
        url: song.song_url,
        onloadfailed: function(){playnextsong(song.post_url)},
        onfinish: function(){playnextsong(song.post_url)}
      });
  });
  
  function playnextsong(previous_song) {
    var bad_idea;
    for (x in playlist) {
      if (playlist[x] != previous_song && bad_idea == previous_song) {
        var mySoundObject = soundManager.getSoundById(playlist[x]);
        mySoundObject.play();
        return;
      }
      bad_idea = playlist[x];
    }
  }
  
  function playrandomsong(previous_song) {
		var x = Math.floor(Math.random()*soundManager.soundIDs.length+1);
		var mySoundObject = soundManager.getSoundById(soundManager.soundIDs[x]);
		mySoundObject.play();
		return;
	}
		
</script>
<h1>ChromeTaster</h1>
</html>